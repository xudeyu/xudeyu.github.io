---
title: 正则表达式参考手册
tags: 字符串 正则表达式
---

**正则表达式**（Regular Expression，RegExp，regex）使用单个字符串来描述和匹配一系列符合某种句法规则的字符串。此概念来自形式化语言理论，最初由贝尔实验室实现。

正则表达式最初在Perl中实现，它的推广得益于UNIX软件的流行，尤其是SED，GREP等。
现在许多编程语言都内置了正则表达式引擎，如PERL、Python、JavaScript、Java、[C++11][c11]等。
很多文本编辑器也支持正则表达式来进行检索和替换（尤其是[Vim][vim-config]！）。

<!--more-->

# 为什么要正则表达式？

> 工欲善其事，必先利其器。

学习任何一门语言或者工具都是为了简化工作，学习正则表达式也不例外。
这里只介绍一个例子。先来看取自12306网站的一段代码：

```javascript
// 来源： http://www.12306.cn/mormhweb/js/adKyfw.min.js, 访问日期： 2016-06-22
d = d.replace("'", "");
d = d.replace("%", "");
d = d.replace("#", "");
d = d.replace("&", "");
d = d.replace("*", "");
d = d.replace("(", "");
d = d.replace(")", "");
d = d.replace("@", "");
d = d.replace("`", "");
d = d.replace("/", "");
d = d.replace("\\", "");
d = d.replace(",", "");
d = d.replace(".", "");
d = d.replace("=", "");
d = d.replace("<", "");
d = d.replace(">", "");
```

上述代码是在过滤掉不合法的搜索字符（姑且不论客户端过滤是否安全），
我们可以用一行正则替换来实现相同的功能：

```javascript
d = d.replace(/'%#\&\*\(\)@`\/\\,\.=<>/g, '');
```

# 基本语法

定义正则表达式的方式在不同的工具中可能有所差别，但正则表达式内容的语法是一致的。
正则表达式有三类语法结构：

1. 串接（与操作）。相邻的字符默认为串接关系。例如`harttle`只能匹配`harttle`，
  不可匹配`hart`。
2. 选择（或操作，`|`）。例如：`harttle|serene`可以匹配`harttle`或者`serene`。
  选择的优先级级低于串接，因此很多情况下都可以省略括号。
3. 数量（限定符）。最常见的数量限定符包括`+`, `?`, `*`，分别表示左侧的字符出现一次或更多，不出现或出现一次，不出现或出现任意次。例如`harttle?`可以匹配`harttl`和`harttle`。
4. 组合（括号，`()`）。组合用来定义操作符的作用范围和优先级。例如`har(ttle)?`可以匹配`harttle`和`har`，`h(a|u)rttle`可以匹配`harttle`和`hurttle`。

# 表达式全集

下面将[我见过最好的RegExp文档][wiki-regexp]摘录在此以供参考。
如果你是第一次接触正则表达式，现在可以结合[用正则表达式分析 URL][regexp-url]一文对照下表进行分析。

| 字符 | 描述 |
| `\\` | 将下一个字符标记为一个特殊字符、或一个原义字符、或一个向后引用、或一个八进制转义符。例如，"`n`"匹配字符"`n`"。"`\n`"匹配一个换行符。序列"`\`"匹配"`\`"而"`(`"则匹配"`(`"。 |
| `^` | 匹配输入字符串的开始位置。如果设置了RegExp对象的Multiline属性，`^`也匹配"`\n`"或"`\r`"之后的位置。 |
| `$` | 匹配输入字符串的结束位置。如果设置了RegExp对象的Multiline属性，`$`也匹配"`\n`"或"`\r`"之前的位置。 |
| `*` | 匹配前面的子表达式零次或多次。例如，zo能匹配"`z`"、"`zo`"以及"`zoo`"。等价于{0,}。 |
| `+` | 匹配前面的子表达式一次或多次。例如，"`zo+`"能匹配"`zo`"以及"`zoo`"，但不能匹配"`z`"。+等价于{1,}。 |
| `?` | 匹配前面的子表达式零次或一次。例如，"`do(es)?`"可以匹配"`do`"或"`does`"中的"`do`"。?等价于{0,1}。 |
| `{n}` | n是一个非负整数。匹配确定的n次。例如，"`o{2}`"不能匹配"`Bob`"中的"`o`"，但是能匹配"`food`"中的两个o。 |
| `{n,}` | n是一个非负整数。至少匹配n次。例如，"`o{2,}`"不能匹配"`Bob`"中的"`o`"，但能匹配"`foooood`"中的所有o。"`o{1,}`"等价于"`o+`"。"`o{0,}`"则等价于"`o`"。 |
| `{n,m}` | m和n均为非负整数，其中n<=m。最少匹配n次且最多匹配m次。例如，"`o{1,3}`"将匹配"`fooooood`"中的前三个o。"`o{0,1}`"等价于"`o?`"。请注意在逗号和两个数之间不能有空格。 |
| `?` | 当该字符紧跟在任何一个其他限制符（*,+,?，{n}，{n,}，{n,m}）后面时，匹配模式是非贪婪的。非贪婪模式尽可能少的匹配所搜索的字符串，而默认的贪婪模式则尽可能多的匹配所搜索的字符串。例如，对于字符串"`oooo`"，"`o+?`"将匹配单个"`o`"，而"`o+`"将匹配所有"`o`"。 |
| `.` | 匹配除"`\n`"之外的任何单个字符。要匹配包括"`\n`"在内的任何字符，请使用像"`(.|\n)`"的模式。 |
| `(pattern)` | 匹配pattern并获取这一匹配的子字符串。该子字符串用于向后引用。所获取的匹配可以从产生的Matches集合得到，在VBScript中使用SubMatches集合，在JScript中则使用`$0...$9`属性。要匹配圆括号字符，请使用"`(`"或"`)`"。 |
| `(?:pattern)` | 匹配pattern但不获取匹配的子字符串，也就是说这是一个非获取匹配，不存储匹配的子字符串用于向后引用。这在使用或字符"`(|)`"来组合一个模式的各个部分是很有用。例如"`industr(?:y|ies)`"就是一个比"`industry|industries`"更简略的表达式。 |
| `(?=pattern)` | 正向肯定预查，在任何匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如，"`Windows(?=95|98|NT|2000)`"能匹配"`Windows2000`"中的"`Windows`"，但不能匹配"`Windows3.1`"中的"`Windows`"。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始。 |
| `(?!pattern)` | 正向否定预查，在任何不匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。例如"`Windows(?!95|98|NT|2000)`"能匹配"`Windows3.1`"中的"`Windows`"，但不能匹配"`Windows2000`"中的"`Windows`"。预查不消耗字符，也就是说，在一个匹配发生后，在最后一次匹配之后立即开始下一次匹配的搜索，而不是从包含预查的字符之后开始 |
| `(?<=pattern)` | 反向肯定预查，与正向肯定预查类似，只是方向相反。例如，"`(?<=95|98|NT|2000)Windows`"能匹配"`2000Windows`"中的"`Windows`"，但不能匹配"`3.1Windows`"中的"`Windows`"。 |
| `(?<!pattern)` | 反向否定预查，与正向否定预查类似，只是方向相反。例如"`(?<!95|98|NT|2000)Windows`"能匹配"`3.1Windows`"中的"`Windows`"，但不能匹配"`2000Windows`"中的"`Windows`"。 |
| `x|y` | 匹配x或y。例如，"`z|food`"能匹配"`z`"或"`food`"。"`(z|f)ood`"则匹配"`zood`"或"`food`"。 |
| `[xyz]` | 字符集合（character class）。匹配所包含的任意一个字符。例如，"`[abc]`"可以匹配"`plain`"中的"`a`"。特殊字符仅有反斜线`\\`保持特殊含义，用于转义字符。其它特殊字符如星号、加号、各种括号等均作为普通字符。脱字符^如果出现在首位则表示负值字符集合；如果出现在字符串中间就仅作为普通字符。连字符 - 如果出现在字符串中间表示字符范围描述；如果如果出现在首位则仅作为普通字符。 |
| `[^xyz]` | 排除型（negate）字符集合。匹配未列出的任意字符。例如，"`[^abc]`"可以匹配"`plain`"中的"`plin`"。 |
| `[a-z]` | 字符范围。匹配指定范围内的任意字符。例如，"`[a-z]`"可以匹配"`a`"到"`z`"范围内的任意小写字母字符。 |
| `[^a-z]` | 排除型的字符范围。匹配任何不在指定范围内的任意字符。例如，"`[^a-z]`"可以匹配任何不在"`a`"到"`z`"范围内的任意字符。 |
| `\b` | 匹配一个单词边界，也就是指单词和空格间的位置。例如，"`er\b`"可以匹配"`never`"中的"`er`"，但不能匹配"`verb`"中的"`er`"。 |
| `\B` | 匹配非单词边界。"`er\B`"能匹配"`verb`"中的"`er`"，但不能匹配"`never`"中的"`er`"。 |
| `\cx` | 匹配由x指明的控制字符。例如，`\cM`匹配一个Control-M或回车符。x的值必须为A-Z或a-z之一。否则，将c视为一个原义的"`c`"字符。 |
| `\d` | 匹配一个数字字符。等价于`[0-9]`。 |
| `\D` | 匹配一个非数字字符。等价于`[^0-9]`。 |
| `\f` | 匹配一个换页符。等价于`\x0c`和`\cL`。 |
| `\n` | 匹配一个换行符。等价于`\x0a`和`\cJ`。 |
| `\r` | 匹配一个回车符。等价于`\x0d`和`\cM`。 |
| `\s` | 匹配任何空白字符，包括空格、制表符、换页符等等。等价于`[ \f\n\r\t\v]`。 |
| `\S` | 匹配任何非空白字符。等价于`[^ \f\n\r\t\v]`。 |
| `\t` | 匹配一个制表符。等价于`\x09`和`\cI`。 |
| `\v` | 匹配一个垂直制表符。等价于`\x0b`和`\cK`。 |
| `\w` | 匹配包括下划线的任何单词字符。等价于"`[A-Za-z0-9]`"。 |
| `\W` | 匹配任何非单词字符。等价于"`[^A-Za-z0-9]`"。 |
| `\xn` | 匹配n，其中n为十六进制转义值。十六进制转义值必须为确定的两个数字长。例如，"`\x41`"匹配"`A`"。"`\x041`"则等价于"`\x04&1`"。正则表达式中可以使用ASCII编码。. |
| `\num` | 向后引用（back-reference）一个子字符串（substring），该子字符串与正则表达式的第num个用括号围起来的子表达式（subexpression）匹配。其中num是从1开始的正整数，其上限可能是99。例如："`(.)\1`"匹配两个连续的相同字符。 |
| `\n` | 标识一个八进制转义值或一个向后引用。如果`\n`之前至少n个获取的子表达式，则n为向后引用。否则，如果n为八进制数字（0-7），则n为一个八进制转义值。 |
| `\nm` | 标识一个八进制转义值或一个向后引用。如果`\nm`之前至少有nm个获得子表达式，则nm为向后引用。如果`\nm`之前至少有n个获取，则n为一个后跟文字m的向后引用。如果前面的条件都不满足，若n和m均为八进制数字（0-7），则`\nm`将匹配八进制转义值nm。 |
| `\nml` | 如果n为八进制数字（0-3），且m和l均为八进制数字（0-7），则匹配八进制转义值nml。 |
| `\un` | 匹配n，其中n是一个用四个十六进制数字表示的Unicode字符。例如，`\u00A9`匹配版权符号（©）。 |

# 参考阅读

* Wikipedia 正则表达式：<https://zh.wikipedia.org/wiki/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F>
* MDN RegExp：<https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions>

[c11]: /2015/10/08/cpp11.html
[vim-config]: /2013/11/08/vim-config.html
[wiki-regexp]: https://zh.wikipedia.org/wiki/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F
[regexp-url]: /2016/02/23/javascript-regular-expressions.html
